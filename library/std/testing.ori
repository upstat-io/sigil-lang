// std.testing - Testing assertions and utilities
//
// This module provides assertion functions for testing Ori code.
// Import with: `use std.testing { assert, assert_eq, ... }`

// Assert that a condition is true
pub @assert (cond: bool) -> void = if !cond then panic(msg: "assertion failed")

// Assert that two values are equal
pub @assert_eq (actual: int, expected: int) -> void =
    if actual != expected then
        panic(msg: "assertion failed: " + str(actual) + " != " + str(expected))

// Assert that two values are not equal
pub @assert_ne (actual: int, unexpected: int) -> void =
    if actual == unexpected then panic(msg: "assertion failed: values are equal: " + str(actual))

// Assert that an Option is Some
pub @assert_some (opt: Option<int>) -> void =
    if is_none(opt: opt) then panic(msg: "assertion failed: expected Some, got None")

// Assert that an Option is None
pub @assert_none (opt: Option<int>) -> void =
    if is_some(opt: opt) then panic(msg: "assertion failed: expected None, got Some")

// Assert that a Result is Ok
pub @assert_ok (result: Result<int, str>) -> void =
    if is_err(result: result) then panic(msg: "assertion failed: expected Ok, got Err")

// Assert that a Result is Err
pub @assert_err (result: Result<int, str>) -> void =
    if is_ok(result: result) then panic(msg: "assertion failed: expected Err, got Ok")

// Assert that an expression panics
pub @assert_panics (f: () -> void) -> void = run(
    let res = catch(
        expr: f(),
    ),
    if is_ok(result: res) then panic(msg: "assertion failed: expected panic but succeeded"),
)

// Assert that an expression panics with a specific message
pub @assert_panics_with (f: () -> void, msg: str) -> void = run(
    let result = catch(
        expr: f(),
    ),
    match(result,
        Err(actual_msg) -> if actual_msg != msg then
            panic(msg: "assertion failed: expected panic with: " + msg + " but got: " + actual_msg),
        Ok(_) -> panic(msg: "assertion failed: expected panic with: " + msg + " but succeeded"),
    ),
)
