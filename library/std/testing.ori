// std.testing - Testing assertions and utilities
//
// This module provides assertion functions for testing Ori code.
// Import with: `use std.testing { assert, assert_eq, ... }`

// Assert that a condition is true
pub @assert (cond: bool) -> void = if !cond then panic(msg: "assertion failed")

// Assert that two values are equal
pub @assert_eq<T: Eq> (actual: T, expected: T) -> void =
    if actual != expected then
        panic(msg: "assertion failed: " + str(actual) + " != " + str(expected))

// Assert that two values are not equal
pub @assert_ne<T: Eq> (actual: T, unexpected: T) -> void =
    if actual == unexpected then panic(msg: "assertion failed: values are equal: " + str(actual))

// Assert that an Option is Some
pub @assert_some<T> (opt: Option<T>) -> void =
    match opt { Some(_) -> (), None -> panic(msg: "assertion failed: expected Some, got None")}

// Assert that an Option is None
pub @assert_none<T> (opt: Option<T>) -> void =
    match opt { Some(_) -> panic(msg: "assertion failed: expected None, got Some"), None -> ()}

// Assert that a Result is Ok
pub @assert_ok<T, E> (result: Result<T, E>) -> void =
    match result { Ok(_) -> (), Err(_) -> panic(msg: "assertion failed: expected Ok, got Err")}

// Assert that a Result is Err
pub @assert_err<T, E> (result: Result<T, E>) -> void =
    match result { Ok(_) -> panic(msg: "assertion failed: expected Err, got Ok"), Err(_) -> ()}

// Assert that an expression panics
pub @assert_panics<T> (f: () -> T) -> void = {
    let res = catch(expr: f());
    match res { Ok(_) -> panic(msg: "assertion failed: expected panic but succeeded"), Err(_) -> ()}
}

// Assert that an expression panics with a specific message
pub @assert_panics_with<T> (f: () -> T, msg: str) -> void = {
    let result = catch(
        expr: f(),
    );
    match result {
        Err(actual_msg) -> if actual_msg != msg then
            panic(msg: "assertion failed: expected panic with: " + msg + " but got: " + actual_msg),
        Ok(_) -> panic(msg: "assertion failed: expected panic with: " + msg + " but succeeded")
    }
}
