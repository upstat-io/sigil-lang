---
import BaseLayout from './BaseLayout.astro';
import DocsSidebar from '../components/docs/DocsSidebar.astro';

interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;
---

<BaseLayout
  title={`${title} — Ori Docs`}
  description={description || `Learn about ${title} in Ori — a programming language with mandatory testing and dependency-aware integrity.`}
  keywords={`Ori docs, ${title.toLowerCase()}, documentation, programming language, tutorial`}
  ogType="article"
>
  <div class="docs-layout">
    <DocsSidebar />
    <main class="docs-content">
      <article class="docs-article">
        <slot />
      </article>
    </main>
  </div>
</BaseLayout>

<style>
  .docs-layout {
    display: flex;
    min-height: calc(100vh - var(--header-height, 56px));
  }

  .docs-content {
    flex: 1;
    min-width: 0;
    padding: var(--space-8, 2rem) var(--space-8, 2rem);
    max-width: var(--max-width-narrow, 800px);
    margin: 0 auto;
  }

  .docs-article {
    line-height: var(--leading-relaxed, 1.65);
  }

  .docs-article :global(h1) {
    margin-bottom: var(--space-6, 1.5rem);
  }

  .docs-article :global(h2) {
    margin-top: var(--space-10, 2.5rem);
    margin-bottom: var(--space-4, 1rem);
    padding-bottom: var(--space-2, 0.5rem);
    border-bottom: 1px solid var(--color-border, #2a2b35);
  }

  .docs-article :global(h3) {
    margin-top: var(--space-8, 2rem);
    margin-bottom: var(--space-3, 0.75rem);
  }

  .docs-article :global(p) {
    margin-bottom: var(--space-4, 1rem);
  }

  .docs-article :global(ul),
  .docs-article :global(ol) {
    margin-bottom: var(--space-4, 1rem);
  }

  .docs-article :global(pre) {
    margin-bottom: var(--space-4, 1rem);
  }

  .docs-article :global(table) {
    margin-bottom: var(--space-4, 1rem);
    font-size: var(--text-sm, 0.875rem);
  }

  .docs-article :global(blockquote) {
    margin-bottom: var(--space-4, 1rem);
  }

  @media (max-width: 768px) {
    .docs-layout {
      flex-direction: column;
    }

    .docs-content {
      padding: var(--space-4, 1rem);
    }
  }


  /* Mermaid diagram styles */
  .docs-article :global(.mermaid) {
    background: var(--color-bg-secondary, #1a1b26);
    border-radius: var(--radius-md, 8px);
    padding: var(--space-4, 1rem);
    margin-bottom: var(--space-4, 1rem);
    overflow-x: auto;
    text-align: center;
  }

  .docs-article :global(.mermaid svg) {
    max-width: 100%;
    height: auto;
    display: inline-block;
  }
</style>

<script>
  import mermaid from 'mermaid';

  mermaid.initialize({
    startOnLoad: false,
    theme: 'dark',
    themeVariables: {
      primaryColor: '#3b82f6',
      primaryTextColor: '#e4e4e7',
      primaryBorderColor: '#3b82f6',
      lineColor: '#71717a',
      secondaryColor: '#27272a',
      tertiaryColor: '#18181b',
      background: '#1a1b26',
      mainBkg: '#27272a',
      nodeBorder: '#3b82f6',
      clusterBkg: '#18181b',
      clusterBorder: '#3b82f6',
      titleColor: '#e4e4e7',
      edgeLabelBackground: '#27272a',
    },
    flowchart: {
      curve: 'basis',
      padding: 20,
    },
  });

  // Render mermaid diagrams
  document.addEventListener('DOMContentLoaded', async () => {
    const codeBlocks = document.querySelectorAll('pre[data-language="mermaid"]');

    for (const pre of codeBlocks) {
      const codeElement = pre.querySelector('code');
      if (!codeElement) continue;

      const code = codeElement.textContent || '';
      const container = document.createElement('div');
      container.className = 'mermaid';

      try {
        const { svg } = await mermaid.render(`mermaid-${Math.random().toString(36).slice(2)}`, code);
        container.innerHTML = svg;
        pre.replaceWith(container);
      } catch (e) {
        console.error('Mermaid render error:', e);
      }
    }
  });
</script>
