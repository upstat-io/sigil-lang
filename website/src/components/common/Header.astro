---
const currentPath = Astro.url.pathname;
const navLinks = [
  { href: '/', label: 'Home', matchPrefix: null },
  { href: '/guide/01-getting-started', label: 'Guide', matchPrefix: '/guide/' },
  { href: '/docs/spec/index', label: 'Docs', matchPrefix: '/docs/' },
  { href: '/playground', label: 'Playground', matchPrefix: '/playground' },
  { href: '/changelog', label: 'Changelog', matchPrefix: '/changelog' },
  { href: '/roadmap', label: 'Roadmap', matchPrefix: '/roadmap' },
];

const isActive = (link: typeof navLinks[0]) => {
  if (link.matchPrefix === null) {
    return currentPath === link.href;
  }
  return currentPath.startsWith(link.matchPrefix);
};
---

<header class="site-header">
  <div class="header-inner">
    <a href="/" class="logo">
      <svg class="logo-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="32" height="32" rx="6" fill="#21222c"/>
        <circle cx="16" cy="16" r="9" stroke="#3b82f6" stroke-width="2.5" fill="none"/>
        <path d="M12 16l2.5 2.5 5.5-5.5" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="logo-text">Ori</span>
    </a>

    <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
      <svg class="menu-icon icon-hamburger" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <line x1="4" y1="6" x2="20" y2="6" />
        <line x1="4" y1="12" x2="20" y2="12" />
        <line x1="4" y1="18" x2="20" y2="18" />
      </svg>
      <svg class="menu-icon icon-close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <line x1="6" y1="6" x2="18" y2="18" />
        <line x1="6" y1="18" x2="18" y2="6" />
      </svg>
    </button>

    <nav class="nav">
      <div class="nav-links">
        {navLinks.map(link => (
          <a
            href={link.href}
            class:list={['nav-link', { active: isActive(link) }]}
          >
            {link.label}
          </a>
        ))}
      </div>
      <div class="nav-icons">
        <a href="https://github.com/sponsors/upstat-io" class="nav-link nav-sponsor" target="_blank" rel="noopener" aria-label="Sponsor Ori">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
          </svg>
          <span class="sponsor-text">Sponsor</span>
        </a>
        <a href="https://github.com/upstat-io/ori-lang/discussions" class="nav-link nav-discuss" target="_blank" rel="noopener" aria-label="Community discussions">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 2C6.48 2 2 6.48 2 12c0 1.54.36 2.98.97 4.29L2 22l5.71-.97A9.96 9.96 0 0012 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.4 0-2.74-.36-3.9-1l-.28-.14-2.9.49.49-2.9-.14-.28A7.95 7.95 0 014 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8z"/>
          </svg>
        </a>
        <a href="https://github.com/upstat-io/ori-lang" class="nav-link nav-github" target="_blank" rel="noopener" aria-label="GitHub repository">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
        </a>
      </div>
    </nav>
  </div>
</header>

<script>
  const toggle = document.querySelector('.menu-toggle');
  const nav = document.querySelector('.nav');
  const header = document.querySelector('.site-header');

  function closeMenu() {
    nav?.classList.remove('open');
    toggle?.setAttribute('aria-expanded', 'false');
    header?.classList.remove('menu-open');
  }

  toggle?.addEventListener('click', () => {
    const isOpen = nav?.classList.toggle('open');
    toggle.setAttribute('aria-expanded', String(isOpen));
    header?.classList.toggle('menu-open', isOpen);
  });

  // Close menu when clicking a link
  nav?.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', closeMenu);
  });

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && nav?.classList.contains('open')) {
      closeMenu();
    }
  });

  // Close menu when clicking the overlay
  header?.addEventListener('click', (e) => {
    if (e.target === header && header.classList.contains('menu-open')) {
      closeMenu();
    }
  });
</script>

<style>
  .site-header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--color-bg-secondary);
    border-bottom: 1px solid var(--color-border);
    height: var(--header-height);
  }

  .header-inner {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 0 var(--space-6);
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    text-decoration: none;
    z-index: 101;
  }

  .logo-icon {
    width: 28px;
    height: 28px;
  }

  .logo-text {
    font-size: var(--text-xl);
    font-weight: var(--weight-bold);
    color: var(--color-accent);
    font-family: var(--font-mono);
  }

  /* Menu toggle button */
  .menu-toggle {
    display: none;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--space-2);
    z-index: 101;
    color: var(--color-text-secondary);
    transition: color var(--transition-fast);
  }

  .menu-toggle:hover {
    color: var(--color-text-primary);
  }

  .menu-icon {
    display: block;
    width: 24px;
    height: 24px;
  }

  .icon-close {
    display: none;
  }

  .menu-toggle[aria-expanded="true"] .icon-hamburger {
    display: none;
  }

  .menu-toggle[aria-expanded="true"] .icon-close {
    display: block;
  }

  /* Navigation */
  .nav {
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  .nav-icons {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    flex-shrink: 0;
  }

  .nav-link {
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .nav-link:hover {
    color: var(--color-text-primary);
    background: var(--color-bg-tertiary);
  }

  .nav-link.active {
    color: var(--color-text-primary);
    background: var(--color-bg-tertiary);
  }

  .nav-discuss,
  .nav-github {
    display: flex;
    align-items: center;
    margin-left: var(--space-2);
    flex-shrink: 0;
  }

  .nav-discuss svg,
  .nav-github svg {
    opacity: 0.7;
    transition: opacity var(--transition-fast);
    min-width: 20px;
    min-height: 20px;
  }

  .nav-discuss:hover svg,
  .nav-github:hover svg {
    opacity: 1;
  }

  .nav-sponsor {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    margin-left: var(--space-2);
    flex-shrink: 0;
  }

  .nav-sponsor svg {
    color: #db61a2;
    opacity: 0.8;
    transition: all var(--transition-fast);
    min-width: 20px;
    min-height: 20px;
  }

  .nav-sponsor:hover svg {
    opacity: 1;
    transform: scale(1.1);
  }

  .sponsor-text {
    font-size: var(--text-sm);
  }

  /* Hide Playground earlier for more breathing room */
  @media (max-width: 900px) {
    .nav-link[href="/playground"] {
      display: none;
    }
  }

  /* Mobile styles */
  @media (max-width: 768px) {
    .menu-toggle {
      display: flex;
    }

    .nav {
      position: fixed;
      top: 0;
      right: 0;
      width: 280px;
      height: 100vh;
      background: var(--color-bg-secondary);
      border-left: 1px solid var(--color-border);
      flex-direction: column;
      align-items: stretch;
      padding: calc(var(--header-height) + var(--space-4)) var(--space-4) var(--space-4);
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.2);
      visibility: hidden;
      opacity: 0;
      z-index: 100;
    }

    .nav.open {
      visibility: visible;
      opacity: 1;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }

    .nav-links {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-1);
    }

    /* Show Playground again in mobile drawer */
    .nav-link[href="/playground"] {
      display: block;
    }

    .nav-link {
      padding: var(--space-3) var(--space-4);
      font-size: var(--text-base);
    }

    .nav-icons {
      margin-top: var(--space-4);
      padding-top: var(--space-4);
      border-top: 1px solid var(--color-border);
      justify-content: center;
      gap: var(--space-4);
    }

    .nav-sponsor,
    .nav-discuss,
    .nav-github {
      margin-left: 0;
    }

    .sponsor-text {
      display: none;
    }

    /* Overlay when menu is open */
    .site-header::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
      pointer-events: none;
    }

    .site-header.menu-open::before {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
  }

  @media (max-width: 640px) {
    .header-inner {
      padding: 0 var(--space-4);
    }
  }
</style>
