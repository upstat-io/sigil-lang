---
import { getCollection } from 'astro:content';
import Sidebar from '../common/Sidebar.astro';

const guide = await getCollection('guide');

// Helper to transform collection items
const toSidebarItems = (items: any[]) =>
  items.map(item => ({ id: item.id, title: item.data.title }));

// Helper to group by part
const groupByPart = (items: any[], partNames: string[]) =>
  partNames
    .map(name => ({
      name,
      items: toSidebarItems(
        items
          .filter(d => d.data.part === name)
          .sort((a, b) => a.data.order - b.data.order)
      ),
    }))
    .filter(g => g.items.length > 0);

// Build sections config
const sections = [
  {
    title: 'Guide',
    basePath: '/guide',
    items: toSidebarItems(
      guide
        .filter(d => !d.data.part)
        .sort((a, b) => a.data.order - b.data.order)
    ),
    subsections: groupByPart(guide, [
      'Foundations',
      'Data',
      'Error Handling & Safety',
      'Program Structure',
      'Effects and Concurrency',
      'Abstraction',
      'Advanced Patterns',
    ]),
  },
];
---

<Sidebar sections={sections} expandAllByDefault={true} />
