# E2024: Trait Not Object-Safe

A trait was used as a trait object, but it violates one or more object safety rules.

## Example

```ori
trait Clone {
    @clone (self) -> Self  // Self in return position
}

@process (items: [Clone]) -> void =  // Error: Clone is not object-safe
    for item in items do print(msg: "item")
```

## Explanation

A trait object (`Trait` used as a type) enables dynamic dispatch â€” the concrete
type is unknown at compile time. Not all traits support this because some require
compile-time type information that is unavailable for trait objects.

### Object Safety Rules

A trait is object-safe if ALL of the following are true:

**Rule 1: No `Self` in return position.** The compiler cannot allocate space for
a return value of unknown size.

```ori
// NOT object-safe
trait Clone {
    @clone (self) -> Self  // What size is the return value?
}
```

**Rule 2: No `Self` in parameter position (except receiver).** The compiler
cannot verify that two trait objects have the same concrete type.

```ori
// NOT object-safe
trait Eq {
    @equals (self, other: Self) -> bool  // other must be same type as self
}
```

**Rule 3: No generic methods.** Generic methods require monomorphization at
compile time, but trait objects defer type information to runtime.

```ori
// NOT object-safe
trait Converter {
    @convert<T> (self) -> T  // Requires monomorphization
}
```

## Common Object-Safe Traits

| Trait | Why Safe |
|-------|----------|
| `Printable` | Returns `str`, not `Self` |
| `Hashable` | Returns `int`, no `Self` params |
| `Debug` | Returns `str`, not `Self` |

## Common Non-Object-Safe Traits

| Trait | Why Unsafe |
|-------|-----------|
| `Clone` | Returns `Self` |
| `Eq` | `Self` as parameter |
| `Default` | Returns `Self` |
| `Comparable` | `Self` as parameter |

## Solution

Use generics instead of trait objects when object safety is needed:

```ori
// Trait object (requires object safety)
@process (items: [Printable]) -> void = ...

// Generic (no object safety requirement)
@process<T: Clone> (items: [T]) -> void = ...
```

## See Also

- E2009: Missing trait bound
- E2001: Type mismatch
