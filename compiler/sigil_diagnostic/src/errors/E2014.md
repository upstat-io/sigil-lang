# E2014: Missing Capability Declaration

A function uses a capability without declaring it in its signature.

## Example

```sigil
@fetch_user (id: int) -> User = run(    // Error: missing 'uses Http'
    let response = http.get(url: "/users/" + str(id)),
    parse_user(response)
)
```

## Explanation

In Sigil, all effects must be explicitly declared. If a function uses a
capability (directly or by calling another function that uses it), it must
declare that capability with `uses`.

## Common Causes

1. **Calling capability-using function without declaring:**
   ```sigil
   // http_get uses Http
   @http_get (url: str) -> str uses Http = ...

   // Wrong - calls http_get but doesn't declare Http
   @fetch_data () -> str = http_get(url: "/data")

   // Right
   @fetch_data () -> str uses Http = http_get(url: "/data")
   ```

2. **Indirect capability usage:**
   ```sigil
   @helper () -> str uses Http = ...
   @processor () -> str uses Http = helper()

   // Wrong - calls processor but doesn't declare Http
   @main_logic () -> str = processor()
   ```

## Solutions

1. **Add the uses clause:**
   ```sigil
   @fetch_user (id: int) -> User uses Http = run(
       let response = http.get(url: "/users/" + str(id)),
       parse_user(response)
   )
   ```

2. **Multiple capabilities:**
   ```sigil
   @sync_data () -> void uses Http, FileSystem, Logger = run(
       logger.info("Starting sync"),
       let data = http.get(url: "/data"),
       fs.write(path: "data.json", content: data)
   )
   ```

3. **Provide the capability with `with...in`:**
   ```sigil
   // If you want to satisfy the capability at call site
   @main () -> void = run(
       with Http = RealHttp {} in
           fetch_user(id: 1)
   )
   ```

## Why Explicit Capabilities?

- **Testability:** Mock capabilities in tests
- **Clarity:** Know what effects a function has
- **Safety:** No hidden side effects
- **Tracking:** Trace effect usage through call graph

## Capability Propagation

Capabilities propagate up the call stack:
```sigil
@a () -> int uses Http = ...
@b () -> int uses Http = a()        // Must declare Http
@c () -> int uses Http = b()        // Must declare Http
@main () -> void = with Http = ... in c()
```

## See Also

- E2012: Unknown capability
- E2013: Provider does not implement capability
