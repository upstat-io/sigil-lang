// Rosetta Code: Loops/While
// Task: Demonstrate a while-loop
// In Sigil, while loops are expressed using the recurse pattern

// Count down from n to 0 (while n > 0)
@countdown (n: int) -> [int] = recurse(
    condition: n <= 0,
    base: [],
    step: [n] + self(n - 1)
)

// Find first power of 2 greater than n
@next_power_of_2 (n: int) -> int = find_power(target: n, current: 1)

@find_power (target: int, current: int) -> int = recurse(
    condition: current > target,
    base: current,
    step: self(target: target, current: current * 2)
)

// Collatz sequence (while n != 1)
@collatz (n: int) -> [int] = recurse(
    condition: n <= 1,
    base: [1],
    step: [n] + self(if n % 2 == 0 then n / 2 else 3 * n + 1)
)

// Sum digits of a number (while n > 0)
@sum_digits (n: int) -> int = recurse(
    condition: n == 0,
    base: 0,
    step: (n % 10) + self(n / 10)
)

// GCD using Euclidean algorithm (while b != 0)
@gcd (a: int, b: int) -> int = recurse(
    condition: b == 0,
    base: a,
    step: self(a: b, b: a % b)
)

@main () -> void = run(
    print(msg: "Countdown from 5: " + str(countdown(5))),
    print(msg: "Next power of 2 after 10: " + str(next_power_of_2(10))),
    print(msg: "Collatz sequence for 6: " + str(collatz(6))),
    print(msg: "Sum digits of 12345: " + str(sum_digits(12345))),
    print(msg: "GCD(48, 18): " + str(gcd(a: 48, b: 18)))
)
