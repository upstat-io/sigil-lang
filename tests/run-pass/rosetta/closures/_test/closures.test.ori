// Tests for Closures/Value capture

use std.testing { assert, assert_eq, assert_ne }
use "../closures" {
    make_adder,
    make_multiplier,
    scale_list,
    create_square_closures,
    make_linear,
    filter_above,
    sum_with_offset,
}

@test_adder tests @make_adder () -> void = run(
    let add5 = make_adder(5),
    let add10 = make_adder(10),
    assert_eq(actual: add5(3), expected: 8),
    assert_eq(actual: add10(3), expected: 13),
    assert_eq(actual: add5(0), expected: 5)
)

@test_multiplier tests @make_multiplier () -> void = run(
    let times2 = make_multiplier(2),
    let times5 = make_multiplier(5),
    assert_eq(actual: times2(7), expected: 14),
    assert_eq(actual: times5(7), expected: 35)
)

@test_scale tests @scale_list () -> void = run(
    assert_eq(actual: scale_list(arr: [1, 2, 3], factor: 10), expected: [10, 20, 30]),
    assert_eq(actual: scale_list(arr: [1, 2, 3], factor: 0), expected: [0, 0, 0]),
    assert_eq(actual: scale_list(arr: [], factor: 5), expected: [])
)

@test_squares tests @create_square_closures () -> void = run(
    assert_eq(actual: create_square_closures(5), expected: [0, 1, 4, 9, 16]),
    assert_eq(actual: create_square_closures(1), expected: [0]),
    assert_eq(actual: create_square_closures(0), expected: [])
)

@test_linear tests @make_linear () -> void = run(
    let f = make_linear(m: 2, b: 3),
    assert_eq(actual: f(0), expected: 3),
    assert_eq(actual: f(5), expected: 13),
    assert_eq(actual: f(-1), expected: 1)
)

@test_filter tests @filter_above () -> void = run(
    assert_eq(actual: filter_above(arr: [1, 5, 3, 8, 2], threshold: 3), expected: [5, 8]),
    assert_eq(actual: filter_above(arr: [1, 2, 3], threshold: 10), expected: []),
    assert_eq(actual: filter_above(arr: [1, 2, 3], threshold: 0), expected: [1, 2, 3])
)

@test_sum_offset tests @sum_with_offset () -> void = run(
    assert_eq(actual: sum_with_offset(arr: [1, 2, 3], offset: 100), expected: 106),
    assert_eq(actual: sum_with_offset(arr: [], offset: 50), expected: 50),
    assert_eq(actual: sum_with_offset(arr: [10], offset: 0), expected: 10)
)
