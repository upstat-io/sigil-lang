// Spec: 07-properties-of-types.md ยง Eq Trait
// Design: 03-type-system/04-traits.md ยง Core Library Traits
// Tests for the Eq trait and equality operations

use std.testing { assert, assert_eq, assert_ne }

// =============================================================================
// Integer Equality
// =============================================================================

@test_int_eq tests @int_eq () -> void = {
    assert(cond: 42 == 42);
    assert(cond: 0 == 0);
    assert(cond: -5 == -5)
}

@int_eq () -> bool = 42 == 42;

@test_int_ne tests @int_ne () -> void = {
    assert(cond: 1 != 2);
    assert(cond: 0 != 1);
    assert(cond: -1 != 1)
}

@int_ne () -> bool = 1 != 2;

// =============================================================================
// Float Equality
// =============================================================================

@test_float_eq tests @float_eq () -> void = {
    assert(cond: 3.14 == 3.14);
    assert(cond: 0.0 == 0.0);
    assert(cond: -1.5 == -1.5)
}

@float_eq () -> bool = 3.14 == 3.14;

@test_float_ne tests @float_ne () -> void = {
    assert(cond: 1.0 != 2.0);
    assert(cond: 0.1 != 0.2)
}

@float_ne () -> bool = 1.0 != 2.0;

// =============================================================================
// Boolean Equality
// =============================================================================

@test_bool_eq tests @bool_eq () -> void = {
    assert(cond: true == true);
    assert(cond: false == false)
}

@bool_eq () -> bool = true == true;

@test_bool_ne tests @bool_ne () -> void = {
    assert(cond: true != false);
    assert(cond: false != true)
}

@bool_ne () -> bool = true != false;

// =============================================================================
// String Equality
// =============================================================================

@test_str_eq tests @str_eq () -> void = {
    assert(cond: "hello" == "hello");
    assert(cond: "" == "");
    assert(cond: "abc" == "abc")
}

@str_eq () -> bool = "hello" == "hello";

@test_str_ne tests @str_ne () -> void = {
    assert(cond: "hello" != "world");
    assert(cond: "abc" != "ABC");
    assert(cond: "" != " ")
}

@str_ne () -> bool = "a" != "b";

// =============================================================================
// Character Equality
// =============================================================================

@test_char_eq tests @char_eq () -> void = {
    assert(cond: 'a' == 'a');
    assert(cond: '\n' == '\n')
}

@char_eq () -> bool = 'a' == 'a';

@test_char_ne tests @char_ne () -> void = {
    assert(cond: 'a' != 'b');
    assert(cond: 'A' != 'a')
}

@char_ne () -> bool = 'a' != 'b';

// =============================================================================
// List Equality
// =============================================================================

@test_list_eq tests @list_eq () -> void = {
    assert(cond: [1, 2, 3] == [1, 2, 3]);
    assert(cond: [] == []);
    assert(cond: ["a", "b"] == ["a", "b"])
}

@list_eq () -> bool = [1, 2] == [1, 2];

@test_list_ne tests @list_ne () -> void = {
    assert(cond: [1, 2] != [1, 3]);
    assert(cond: [1] != [1, 2]);
    assert(cond: [] != [1])
}

@list_ne () -> bool = [1] != [2];

// =============================================================================
// Eq Trait Bound
// =============================================================================

@are_equal<T: Eq> (a: T, b: T) -> bool = a == b;

@test_eq_bound_int tests @are_equal () -> void = {
    assert(cond: are_equal(a: 42, b: 42));
    assert(cond: !are_equal(a: 1, b: 2))
}

@test_eq_bound_str tests @are_equal () -> void = {
    assert(cond: are_equal(a: "hello", b: "hello"));
    assert(cond: !are_equal(a: "foo", b: "bar"))
}

@test_eq_bound_bool tests @are_equal () -> void = {
    assert(cond: are_equal(a: true, b: true));
    assert(cond: !are_equal(a: true, b: false))
}

@are_different<T: Eq> (a: T, b: T) -> bool = a != b;

@test_ne_bound_int tests @are_different () -> void = {
    assert(cond: are_different(a: 1, b: 2));
    assert(cond: !are_different(a: 42, b: 42))
}

// =============================================================================
// assert_eq and assert_ne Built-in Functions
// =============================================================================

@test_assert_eq_int tests @assert_eq_int () -> void = {
    assert_eq(
        actual: 42,
        expected: 42,
    )
}

@assert_eq_int () -> void = assert_eq(
    actual: 1,
    expected: 1,
);

@test_assert_eq_str tests @assert_eq_str () -> void = {
    assert_eq(
        actual: "hello",
        expected: "hello",
    )
}

@assert_eq_str () -> void = assert_eq(
    actual: "a",
    expected: "a",
);

@test_assert_ne_int tests @assert_ne_int () -> void = {
    assert_ne(
        actual: 1,
        unexpected: 2,
    )
}

@assert_ne_int () -> void = assert_ne(
    actual: 1,
    unexpected: 2,
);

@test_assert_ne_str tests @assert_ne_str () -> void = {
    assert_ne(
        actual: "foo",
        unexpected: "bar",
    )
}

@assert_ne_str () -> void = assert_ne(
    actual: "x",
    unexpected: "y",
);

// =============================================================================
// Complex Equality
// =============================================================================

@test_nested_list_eq tests @nested_list_eq () -> void = {
    let a = [[1, 2], [3, 4]];
    let b = [[1, 2], [3, 4]];
    assert(cond: a == b)
}

@nested_list_eq () -> bool = [[1]] == [[1]];

@test_equality_reflexive tests @equality_reflexive () -> void = {
    // a == a for any a (reflexivity)
    let x = 42;
    assert(cond: x == x);
    let s = "test";
    assert(cond: s == s)
}

@equality_reflexive () -> bool = {
    let x = 1;
    x == x
}

@test_equality_symmetric tests @equality_symmetric () -> void = {
    // a == b implies b == a (symmetry)
    let a = 42;
    let b = 42;
    assert(cond: a == b);
    assert(cond: b == a)
}

@equality_symmetric () -> bool = {
    let a = 1;
    let b = 1;
    (a == b) == (b == a)
}
