// Spec: 08-declarations.md ยง Traits (Default Type Parameters)
// Tests for default type parameters on traits

use std.testing { assert, assert_eq }

// =============================================================================
// Basic Default Type Parameters
// =============================================================================

// Trait with single default type parameter
trait Addable<Rhs = Self> {
    @add (self, rhs: Rhs) -> Self
}

// Trait with multiple defaults
trait Transform<Input = Self, Output = Input> {
    @transform (self, input: Input) -> Output
}

// Trait with mixed parameters (non-default first, default last)
trait Container<T, Default = int> {
    @get (self) -> T
    @default_value (self) -> Default
}

// =============================================================================
// Type Definitions for Tests
// =============================================================================

type Point = { x: int, y: int }

// Helper function to create points
@make_point (x: int, y: int) -> Point = Point { x, y }

// Impl without type args - uses default (Rhs = Self = Point)
impl Addable for Point {
    @add (self, rhs: Point) -> Point = Point {
        x: self.x + rhs.x,
        y: self.y + rhs.y
    }
}

// =============================================================================
// Tests
// =============================================================================

@test tests @make_point () -> void =
    {
        let p = make_point(x: 1, y: 2);
        assert_eq(actual: p.x, expected: 1);
        assert_eq(actual: p.y, expected: 2)
    }

@test tests @add () -> void =
    {
        let p1 = make_point(x: 1, y: 2);
        let p2 = make_point(x: 3, y: 4);
        let result = p1.add(rhs: p2);
        assert_eq(actual: result.x, expected: 4);
        assert_eq(actual: result.y, expected: 6)
    }
