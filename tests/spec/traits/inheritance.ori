// Spec: 08-declarations.md ยง Trait Inheritance
// Tests for trait inheritance syntax and behavior

use std.testing { assert, assert_eq }

// =============================================================================
// Basic Trait Inheritance
// =============================================================================

// Base trait
trait Named {
    @name (self) -> str
}

// Child trait inherits from Named
trait Describable: Named {
    @describe (self) -> str
}

type Person = { first_name: str, last_name: str }

// Implementing the child trait requires implementing the parent trait too
impl Named for Person {
    @name (self) -> str = self.first_name + " " + self.last_name;
}

impl Describable for Person {
    @describe (self) -> str = "Person: " + self.name();
}

// =============================================================================
// Multi-level Inheritance
// =============================================================================

// Grandparent trait
trait Identifiable {
    @id (self) -> int
}

// Parent trait inherits from Identifiable
trait Trackable: Identifiable {
    @track (self) -> str
}

// Child trait inherits from Trackable (which inherits from Identifiable)
trait Auditable: Trackable {
    @audit (self) -> str
}

type Record = { record_id: int, data: str }

impl Identifiable for Record {
    @id (self) -> int = self.record_id;
}

impl Trackable for Record {
    @track (self) -> str = "Tracking record #" + str(self.id());
}

impl Auditable for Record {
    @audit (self) -> str = "Audit: " + self.track() + " [" + self.data + "]";
}

// =============================================================================
// Default Methods in Inherited Traits
// =============================================================================

trait Printable {
    @to_string (self) -> str
}

trait Formatted: Printable {
    @format (self) -> str = "[Formatted: " + self.to_string() + "]";
}

type Value = { amount: int }

impl Printable for Value {
    @to_string (self) -> str = str(self.amount);
}

impl Formatted for Value {
    // Use default implementation by not overriding format()
}

// =============================================================================
// Override Default in Child Trait
// =============================================================================

type Currency = { amount: int, symbol: str }

impl Printable for Currency {
    @to_string (self) -> str = self.symbol + str(self.amount);
}

impl Formatted for Currency {
    // Override the default format method
    @format (self) -> str = "Currency: " + self.to_string();
}

// =============================================================================
// Tests
// =============================================================================

@test_parent_trait_method tests @name () -> void = {
    let person = Person { first_name: "John", last_name: "Doe" };
    assert_eq(actual: person.name(), expected: "John Doe")
}

@test_child_trait_method tests @describe () -> void = {
    let person = Person { first_name: "John", last_name: "Doe" };
    assert_eq(actual: person.describe(), expected: "Person: John Doe")
}

@test_grandparent_trait_method tests @id () -> void = {
    let record = Record { record_id: 42, data: "test data" };
    assert_eq(actual: record.id(), expected: 42)
}

@test_parent_uses_grandparent tests @track () -> void = {
    let record = Record { record_id: 123, data: "test" };
    assert_eq(actual: record.track(), expected: "Tracking record #123")
}

@test_child_uses_parent_and_grandparent tests @audit () -> void = {
    let record = Record { record_id: 7, data: "important" };
    assert_eq(actual: record.audit(), expected: "Audit: Tracking record #7 [important]")
}

@test_inherited_default_method tests @format () -> void = {
    let value = Value { amount: 100 };
    assert_eq(actual: value.format(), expected: "[Formatted: 100]")
}

@test_overridden_inherited_method () -> void = {
    let currency = Currency { amount: 50, symbol: "$" };
    assert_eq(actual: currency.format(), expected: "Currency: $50")
}
