// Spec: 09-expressions.md § Index Trait — Option return pattern
// Tests for Index impls that return Option<T> for safe access

use std.testing { assert_eq }

// =============================================================================
// Index returning Option<T> — sparse data pattern
// =============================================================================

type Sparse = { data: {int: str} }

impl Index<int, Option<str>> for Sparse {
    @index (self, key: int) -> Option<str> = self.data[key]
}

@sparse_found () -> Option<str> = {
    let s = Sparse { data: { 0: "zero", 5: "five" } };
    s[5]
}

@test_sparse_found tests @sparse_found () -> void =
    assert_eq(actual: sparse_found(), expected: Some("five"))

@sparse_missing () -> Option<str> = {
    let s = Sparse { data: { 0: "zero", 5: "five" } };
    s[99]
}

@test_sparse_missing tests @sparse_missing () -> void =
    assert_eq(actual: sparse_missing(), expected: None)

// =============================================================================
// Using ?? with Index result
// =============================================================================

@sparse_with_default () -> str = {
    let s = Sparse { data: { 0: "zero" } };
    s[99] ?? "default"
}

@test_sparse_with_default tests @sparse_with_default () -> void =
    assert_eq(actual: sparse_with_default(), expected: "default")
