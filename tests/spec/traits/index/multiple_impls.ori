// Spec: 09-expressions.md § Index Trait — Multiple implementations
// Tests for types with multiple Index<K, V> impls (different key types)

use std.testing { assert_eq }

// A type implementing Index for both int and str keys
type JsonValue = { data: str }

impl Index<int, str> for JsonValue {
    @index (self, key: int) -> str = "int_" + self.data;
}

impl Index<str, str> for JsonValue {
    @index (self, key: str) -> str = "str_" + self.data;
}

// Int key dispatches to Index<int, str>
@json_int_index () -> str = {
    let j = JsonValue { data: "hello" };
    j[0]
}

@test_json_int_index tests @json_int_index () -> void =
    assert_eq(actual: json_int_index(), expected: "int_hello");

// Str key dispatches to Index<str, str>
@json_str_index () -> str = {
    let j = JsonValue { data: "hello" };
    j["key"]
}

@test_json_str_index tests @json_str_index () -> void =
    assert_eq(actual: json_str_index(), expected: "str_hello");

// Both key types on same value
@json_both_keys () -> str = {
    let j = JsonValue { data: "x" };
    j[0] + " " + j["k"]
}

@test_json_both_keys tests @json_both_keys () -> void =
    assert_eq(actual: json_both_keys(), expected: "int_x str_x");
