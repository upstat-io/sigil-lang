// Verification test for associated types functionality

use std.testing { assert, assert_eq }

// Test 1: Does Self.Item actually resolve to the correct type?
trait Producer {
    type Item
    @produce (self) -> Self.Item
}

type IntProducer = { value: int }

impl Producer for IntProducer {
    type Item = int
    @produce (self) -> Self.Item = self.value
}

// This should work if Self.Item resolves to int
@test_produce_int tests @produce () -> void = run(
    let p = IntProducer { value: 42 },
    let result: int = p.produce(),
    assert_eq(actual: result, expected: 42),
)

// Test 2: Does it work with different types?
type StrProducer = { text: str }

impl Producer for StrProducer {
    type Item = str
    @produce (self) -> Self.Item = self.text
}

@test_produce_str tests @produce () -> void = run(
    let p = StrProducer { text: "hello" },
    let result: str = p.produce(),
    assert_eq(actual: result, expected: "hello"),
)

