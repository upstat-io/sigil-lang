// Spec: spec/09-expressions.md § Comparison Operators
// Design: design/02-syntax/02-expressions.md § Comparison
//
// Tests comparison and logical operations

// Helper function for tests
@identity (x: int) -> int = x

// =============================================================================
// Equality
// Spec: spec/09-expressions.md § == and !=
// =============================================================================

@test_equal_int tests @identity () -> void = run(
    assert(42 == 42),
    assert(42 != 43),
    assert(0 == 0),
    assert(-1 == -1),
)

@test_equal_float tests @identity () -> void = run(
    assert(3.14 == 3.14),
    assert(3.14 != 3.15),
    assert(0.0 == 0.0),
)

@test_equal_str tests @identity () -> void = run(
    assert("hello" == "hello"),
    assert("hello" != "world"),
    assert("" == ""),
)

@test_equal_bool tests @identity () -> void = run(
    assert(true == true),
    assert(false == false),
    assert(true != false),
)

@test_equal_list tests @identity () -> void = run(
    assert([1, 2, 3] == [1, 2, 3]),
    assert([1, 2] != [1, 2, 3]),
    assert([] == []),
)

// =============================================================================
// Ordering
// Spec: spec/09-expressions.md § < > <= >=
// =============================================================================

@test_less_than tests @identity () -> void = run(
    assert(1 < 2),
    assert(-1 < 0),
    assert(!(2 < 1)),
    assert(!(1 < 1)),
)

@test_greater_than tests @identity () -> void = run(
    assert(2 > 1),
    assert(0 > -1),
    assert(!(1 > 2)),
    assert(!(1 > 1)),
)

@test_less_equal tests @identity () -> void = run(
    assert(1 <= 2),
    assert(1 <= 1),
    assert(!(2 <= 1)),
)

@test_greater_equal tests @identity () -> void = run(
    assert(2 >= 1),
    assert(1 >= 1),
    assert(!(1 >= 2)),
)

// =============================================================================
// Logical Operators
// Spec: spec/09-expressions.md § && || with short-circuit
// =============================================================================

@test_logical_and tests @identity () -> void = run(
    assert((true && true) == true),
    assert((true && false) == false),
    assert((false && true) == false),
    assert((false && false) == false),
)

@test_logical_or tests @identity () -> void = run(
    assert((true || true) == true),
    assert((true || false) == true),
    assert((false || true) == true),
    assert((false || false) == false),
)

@test_logical_not tests @identity () -> void = run(
    assert(!true == false),
    assert(!false == true),
    assert(!!true == true),
)

// =============================================================================
// Short-Circuit Evaluation
// Spec: spec/09-expressions.md § right operand evaluated only if necessary
// =============================================================================

@should_not_call () -> bool = run(
    assert(false),
    true,
)

@test_short_circuit_and tests @identity tests @should_not_call () -> void = run(
    let result = false && should_not_call(),
    assert(result == false),
)

@test_short_circuit_or tests @identity tests @should_not_call () -> void = run(
    let result = true || should_not_call(),
    assert(result == true),
)

// =============================================================================
// Comparison Return Type
// Spec: spec/09-expressions.md § Comparison operators return bool
// =============================================================================

@comparison_returns_bool (a: int, b: int) -> bool = a < b

@test_comparison_type tests @comparison_returns_bool () -> void = run(
    let result = comparison_returns_bool(1, 2),
    assert(result == true),
)
