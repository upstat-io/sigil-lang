// Spec Tests: 09-expressions.md - Postfix Expressions
// Tests are the source of truth - the compiler must conform to these tests

// =============================================================================
// Index Access (Spec: postfix = expression "[" expression "]")
// =============================================================================

@test_index_list () -> void = run(
    let arr = [10, 20, 30, 40],
    assert(arr[0] == 10),
    assert(arr[1] == 20),
    assert(arr[3] == 40),
)

@test_index_from_end () -> void = run(
    let arr = [1, 2, 3, 4, 5],
    // Spec: # inside brackets refers to length
    assert(arr[# - 1] == 5),
    assert(arr[# - 2] == 4),
)

@test_index_map () -> void = run(
    let m = {"a": 1, "b": 2, "c": 3},
    assert(m["a"] == 1),
    assert(m["b"] == 2),
)

@test_index_nested () -> void = run(
    let matrix = [[1, 2], [3, 4], [5, 6]],
    assert(matrix[0][0] == 1),
    assert(matrix[1][1] == 4),
    assert(matrix[2][0] == 5),
)

// =============================================================================
// Field Access (Spec: postfix = expression "." identifier)
// =============================================================================

#[skip("type definitions not yet supported")]
@test_field_access tests @test_index_list () -> void = run(
    let p = Point { x: 3, y: 4 },
    assert(p.x == 3),
    assert(p.y == 4),
)

// =============================================================================
// Method Call (Spec: postfix = expression "." identifier "(" args ")")
// =============================================================================

@test_method_call () -> void = run(
    let s = "hello",
    // String methods
    assert(len(s) == 5),
)

// =============================================================================
// Chained Access
// =============================================================================

#[skip("type definitions not yet supported")]
@test_chained_field tests @test_field_access () -> void = run(
    let r = Rect {
        origin: Point { x: 0, y: 0 },
        size: Point { x: 10, y: 20 },
    },
    assert(r.origin.x == 0),
    assert(r.size.y == 20),
)

// =============================================================================
// Error Propagation (Spec: postfix = expression "?")
// =============================================================================

@test_propagation tests @test_index_list () -> void = run(
    assert(true),
)

@test_result_propagation tests @test_propagation () -> void = run(
    assert(true),
)
