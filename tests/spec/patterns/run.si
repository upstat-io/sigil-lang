// Spec: spec/10-patterns.md § Sequential Execution - run
// Design: design/02-syntax/04-patterns-reference.md § run
//
// Tests the run pattern for sequential execution with bindings

// Helper function for tests
@identity (x: int) -> int = x

@add (a: int, b: int) -> int = a + b

// =============================================================================
// Test: Evaluate each binding in order
// Spec: spec/10-patterns.md § run - Semantics
// Design: design/02-syntax/04-patterns-reference.md § run - Evaluation Order
// =============================================================================
@test_run_evaluates_bindings_in_order tests @identity () -> void = run(
    let a = 1,
    let b = a + 1,
    let c = b + 1,
    assert_eq(c, 3),
)

// =============================================================================
// Test: Each binding introduces variable into scope
// Spec: spec/10-patterns.md § run - Semantics
// Design: design/02-syntax/04-patterns-reference.md § run - Scoping
// =============================================================================
@test_run_bindings_in_scope tests @identity () -> void = run(
    let x = 10,
    let y = x * 2,
    let z = x + y,
    assert_eq(z, 30),
)

// =============================================================================
// Test: Final expression is the result
// Spec: spec/10-patterns.md § run - Semantics
// Design: design/02-syntax/04-patterns-reference.md § run - Return Value
// =============================================================================
@test_run_returns_final_expression tests @identity () -> void = run(
    let result = run(
        let a = 5,
        let b = 3,
        a + b,
    ),
    assert_eq(result, 8),
)

// =============================================================================
// Test: Binding with type annotation
// Spec: spec/10-patterns.md § run - Grammar
// Design: design/02-syntax/04-patterns-reference.md § run - Typed Bindings
// =============================================================================
@test_run_typed_binding tests @identity () -> void = run(
    let x: int = 42,
    assert_eq(x, 42),
)

// =============================================================================
// Test: Single expression run
// Spec: spec/10-patterns.md § run - Grammar
// Design: design/02-syntax/04-patterns-reference.md § run - Minimal Form
// =============================================================================
@test_run_single_expression tests @identity () -> void = run(
    let result = run(42),
    assert_eq(result, 42),
)

// =============================================================================
// Test: run with function calls
// Spec: spec/10-patterns.md § run - Semantics
// Design: design/02-syntax/04-patterns-reference.md § run - Expression Evaluation
// =============================================================================
@test_run_with_function_calls tests @add () -> void = run(
    let sum = add(2, 3),
    assert_eq(sum, 5),
)
