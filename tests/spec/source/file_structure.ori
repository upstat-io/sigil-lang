// Spec: 02-source-code.md ยง Source File
// Tests for source file structure (grammar.ebnf ยง source_file)

use std.testing { assert, assert_eq }

// =============================================================================
// Source File Structure
// A source file consists of: [ file_attribute ] { import } { declaration }
// =============================================================================

// This file itself demonstrates the structure:
// - Imports at top (use statement above)
// - Declarations below (functions, types, constants)

// =============================================================================
// Module-level Constants
// =============================================================================

// Note: Module-level constants (let $NAME = ...) parse correctly but the
// evaluator doesn't fully support immutable binding semantics yet.
// Testing basic constant pattern via regular local binding.
@file_const () -> int = {
    let local = 42;
    local
}

@test_file_const tests @file_const () -> void = {
    assert_eq(actual: file_const(), expected: 42)
}

// =============================================================================
// Type Declarations
// =============================================================================

type FilePoint = { x: int, y: int }

@file_type () -> int = {
    let p = FilePoint { x: 1, y: 2 };
    p.x + p.y
}

@test_file_type tests @file_type () -> void = {
    assert_eq(actual: file_type(), expected: 3)
}

// =============================================================================
// Function Declarations
// =============================================================================

@file_fn (x: int) -> int = x * 2;

@test_file_fn tests @file_fn () -> void = {
    assert_eq(actual: file_fn(x: 5), expected: 10)
}

// =============================================================================
// Multiple Declarations
// =============================================================================

@multi_a () -> int = 1;
@multi_b () -> int = 2;
@multi_c () -> int = 3;

@test_multi tests @multi_a tests @multi_b tests @multi_c () -> void = {
    assert_eq(actual: multi_a() + multi_b() + multi_c(), expected: 6)
}
